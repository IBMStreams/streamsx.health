# Patients Monitoring Demo Rules 

These are the rules projects used by the PatientsMonitoringDemo.  The rules check for patients' vitals and raise an alert 
when the vitals exceed the normal ranges.  The rules are written using Operation Decision Manager (ODM).

This sample contains the following projects:

* HealthRules - ODM project for defining rules
* health-xom - Java project that defines the XOM model for the ODM project
* com.ibm.streamsx.health.sample.patients.monitoring.rules - The SPL project for the SPL code generated by the rules compiler using the ODM project.

# Dependencies

This sample depends on the following microservices and toolkits:
* com.ibm.streamsx.health.ingest
* com.ibm.streamsx.json
* com.ibm.streamsx.topology
* com.ibm.streams.rulescompiler

# Build 

To build this sample, it is expected that your environment is set up to use the Java Application API from the com.ibm.streamsx.topology project.

The following environment variables need to be set.  The sample will work with Streams 4.2.0.0 and up:

* STREAMS_SPLPATH=/opt/ibm/InfoSphere_Streams/4.2.0.0/toolkits
* STREAMS_INSTALL=/opt/ibm/InfoSphere_Streams/4.2.0.0
* STREAMS_DOMAIN_ID=StreamsDomain
* STREAMS_INSTANCE_ID=StreamsInstance

To build:

```
git clone https://github.com/IBMStreams/streamsx.health.git
cd streamsx.health
./gradlew build
```

This will take a few minutes for the Healtcare Streaming Platform to build.

# Development

You can update the rules using Streams Studio.  To import the projects into Streams Studio:

1.  Add the toolkits as specified in the Dependencies section as Toolkits Locations in Streams Studio
1.  Import the projects:
    1.  File -> Import -> General -> Existing Projects into Workspace
    1.  Navigate to streamsx.health/samples/PatientsMonitoringDemo.rules
    1.  Import all the projects into Streams Studio
1.  Once the projects are imported, switch to the Rules Perspective in Streams Studio
1.  Open the HealthRules project to update the rules. 

To regenerate the SPL application.

1.  Select the HealthRules project in the Rule Explorer
1.  Right click -> Generate SPL Source File...
1.  Specify the following in the dialog:
    1.  SPL Project:  com.ibm.streamsx.health.sample.patientsmonitoring.rules
    1.  SPL Namespace:  com.ibm.streamsx.health.sample.patientsmonitoring.rules.generated
    1.  Uncheck "Generate function definitions"
    1.  Check Overwrite existing files
    1.  Check Split rule set by package
    1.  Check Generate type definitions
1.  Click Generate

This will generate SPL code into the following composite in the com.ibm.streamsx.health.sample.patientsmonitoring.rules project:

* com.ibm.streamsx.health.sample.patientsmonitoring.rules.generated::HealthRules

If you select to **Generate function definitions** and have your functions overwritten, it may result in compile errors
in your workspace.  To fix the compile error, make sure the setAlert and addToMessages functions are defined as follows:

```
public void addToMessages(mutable Patient obj, ustring arg0) {

	appendM(obj.messages, arg0);
}

public void setAlert(mutable Patient obj) {
	obj.alert = true;
}
```





